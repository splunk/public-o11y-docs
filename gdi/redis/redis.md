(redis)=

# Redis
<meta name="description" content="Documentation on the redis monitor">

## Description

The {ref}`Splunk Distribution of OpenTelemetry Collector <otel-intro>` deploys this integration as the Redis monitor type using the Smart Agent Receiver.

Using the Redis monitor, you can capture the following metrics:

 * Memory used
 * Commands processed per second
 * Number of connected clients and followers
 * Number of blocked clients
 * Number of keys stored per database
 * Uptime
 * Changes since last save
 * Replication delay per follower

This monitor is available on Kubernetes, Windows, and Linux. It accepts endpoints and allows multiple instances.

### Requirements

The monitor supports Redis 2.8 and higher.

### Benefits

```{include} /_includes/benefits.md
```

## Installation

```{include} /_includes/collector-installation.md
```

## Configuration

```{include} /_includes/configuration.md
```

```{note}
Provide a Redis monitor entry in your Collector or Smart Agent (deprecated) configuration. Use the appropriate form for your agent type.
```

### Splunk Distribution of OpenTelemetry Collector

To activate this monitor in the Splunk Distribution of OpenTelemetry Collector, add the following to your agent configuration:

```yaml
receivers:
  smartagent/redis:
    type: collectd/redis
    ...  # Additional config
```

To complete the monitor activation, you must also include the `smartagent/redis` receiver item in a `metrics` pipeline. To do this, add the receiver item to the `service` > `pipelines` > `metrics` > `receivers` section of your configuration file. For example:

```yaml
service:
  pipelines:
    metrics:
      receivers: [smartagent/redis]
```

### Smart Agent

To activate this monitor in the Smart Agent, add the following to your agent configuration:

```yaml
monitors:  # All monitor config goes under this key
  - type: collectd/redis
    ...  # Additional config
```

The following example shows you a YAML configuration file for the Smart Agent:

```yaml
monitors:
- type: collectd/redis
  host: 127.0.0.1
  port: 9100
```

The next example shows you a YAML configuration file that includes list length monitoring:

```yaml
monitors:
- type: collectd/redis
  host: 127.0.0.1
  port: 9100
  sendListLengths:
  - databaseIndex: 0
    keyPattern: 'mylist*'
```

See {ref}`smart-agent` for an autogenerated example of a YAML configuration file, with default values where applicable.

### Configuration settings

The following table shows the configuration options for the Redis monitor:

| Option | Required | Type | Description |
| --- | --- | --- | --- |
| `host`            | Yes      | `string`                      |                                                                                                                                                              |
| `port`            | Yes      | `integer`                     |                                                                                                                                                              |
| `pythonBinary`    | No           | `string`                      | Path to the Python binary. If you don't provide a path, the monitor uses its built-in runtime. The string can include arguments to the binary. |
| `name`            | No           | `string`                      | Name for the Redis instance. The maximum length is 64 characters. The default value is "{host}:{port}".                                       |
| `auth`            | No           | `string`                      | Authentication password.                                                                                                                                     |
| `sendListLengths` | No           | `list of objects (see below)` | List of keys that you want to monitor for length. To learn more, see the section **Monitor the length of Redis lists**.                                      |
| `verbose`         | No           | `bool`                        | Flag that controls verbose logging for the plugin. If `true`, verbose logging is enabled. The default value is`false`.                                             |

The following table shows you the configuration options for the `sendListLengths` configuration object:

| Option | Required | Type | Description |
| --- | --- | --- | --- |
| `databaseIndex` | Yes      | `integer` | The database index                                                                                                                                                                                                                             |
| `keyPattern`    | Yes      | `string`  | A string or pattern to use for selecting keys. A string selects a single key. A pattern that uses `*` as a `glob` style wildcard processes all keys that match the pattern. Surround a pattern with single quotes ('), for example `'mylist*'` |


### Monitor the length of Redis lists

To monitor the length of list keys, you must specify the key and database index in the configuration using the following syntax:

```
sendListLengths: [{databaseIndex: $db_index, keyPattern: "$key_name"}]
```

You can specify `$key_name` as a glob-style pattern. The only supported wildcard is `*` . When you use a pattern, the configuration processes all keys that match the pattern. 

To ensure that the `*` is interpreted correctly, surround the pattern with double quotes (`""`). When a nonlist key matches the pattern, the Redis monitor writes an error to the agent logs.

In Observability Cloud, `gauge.key_llen` is the metric name for Redis list key lengths. Observability Cloud creates a separate MTS
for each Redis list.

**Notes**:

1. The Redis monitor uses the `KEYS` command to match patterns. Because this command isn't optimized, you need to keep your match patterns small. Otherwise, the command can block other commands from executing.
2. To avoid duplicate reporting, choose a single node in which to monitor list lengths. You can use the main node configuration or a follower node configuration.

## Metrics

The following metrics are available for this integration:

<div class="metrics-yaml" url="https://raw.githubusercontent.com/signalfx/integrations/main/redis/metrics.yaml"></div>

## Database Query Performance

You can troubleshoot Redis command performance issues using Database Query Performance in Splunk APM.

* For a sample use case, see {ref}`redis-use-case`.
* For more information on Database Query Performance support for Redis, see {ref}`redis-db-query-performance`.

## Get help

```{include} /_includes/troubleshooting.md
```
